<div class="planning-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="title-section">
        <h1>üìÖ Emploi du Temps</h1>
        <p class="subtitle">G√©rez vos √©v√©nements et plannings</p>
      </div>
      <div class="date-navigation">
        <button class="nav-btn" (click)="previousDay()" title="Jour pr√©c√©dent">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <button class="today-btn" (click)="today()">Aujourd'hui</button>
        <button class="nav-btn" (click)="nextDay()" title="Jour suivant">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    {{ error }}
    <button (click)="error = null" class="close-btn">&times;</button>
  </div>

  <div class="content-grid">
    <!-- Form Section -->
    <div class="form-section">
      <div class="form-card">
        <h2>{{ isEditing ? '‚úèÔ∏è Modifier l\'√©v√©nement' : '‚ûï Nouvel √©v√©nement' }}</h2>
        <form [formGroup]="planningForm" (ngSubmit)="onSubmit()">
          <div class="form-group">
            <label for="date">Date *</label>
            <input
              type="date"
              id="date"
              formControlName="date"
              class="form-control"
              (change)="onDateChange($event)"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="startTime">Heure d√©but *</label>
              <select id="startTime" formControlName="startTime" class="form-control">
                <option value="">S√©lectionner</option>
                <option *ngFor="let time of timeSlots" [value]="time">{{ time }}</option>
              </select>
            </div>

            <div class="form-group">
              <label for="endTime">Heure fin *</label>
              <select id="endTime" formControlName="endTime" class="form-control">
                <option value="">S√©lectionner</option>
                <option *ngFor="let time of timeSlots" [value]="time">{{ time }}</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="title">Titre *</label>
            <input
              type="text"
              id="title"
              formControlName="title"
              class="form-control"
              placeholder="Ex: Cours de math√©matiques"
            />
          </div>

          <div class="form-group">
            <label for="eventType">Type d'√©v√©nement *</label>
            <select id="eventType" formControlName="eventType" class="form-control" (change)="onEventTypeChange($event)">
              <option *ngFor="let type of eventTypes" [value]="type.value">
                {{ type.icon }} {{ type.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="location">Lieu</label>
            <input
              type="text"
              id="location"
              formControlName="location"
              class="form-control"
              placeholder="Ex: Salle A101"
            />
          </div>

          <div class="form-group">
            <label for="description">Description</label>
            <textarea
              id="description"
              formControlName="description"
              class="form-control"
              rows="3"
              placeholder="D√©tails suppl√©mentaires..."
            ></textarea>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary" [disabled]="planningForm.invalid || loading">
              {{ isEditing ? 'Mettre √† jour' : 'Cr√©er' }}
            </button>
            <button type="button" class="btn btn-secondary" (click)="resetForm()" *ngIf="isEditing">
              Annuler
            </button>
          </div>
        </form>
      </div>

      <!-- Toggle Events -->
      <div class="toggle-card">
        <label class="toggle-label">
          <input type="checkbox" [(ngModel)]="showEvents" (change)="filterByDate()" />
          <span>Afficher les √©v√©nements existants</span>
        </label>
        <p class="toggle-hint">Les √©v√©nements cr√©√©s dans la section "Event Management"</p>
      </div>

      <!-- Legend -->
      <div class="legend-card">
        <h3>L√©gende</h3>
        <div class="legend-items">
          <div class="legend-item" *ngFor="let type of eventTypes">
            <span class="legend-color" [style.background-color]="type.color"></span>
            <span>{{ type.icon }} {{ type.label }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Schedule Section -->
    <div class="schedule-section">
      <div class="schedule-header">
        <h2>{{ formatDate(selectedDate) }}</h2>
        <span class="event-count">{{ getTotalEventsCount() }} √©v√©nement(s)</span>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading">
        <div class="spinner"></div>
        <p>Chargement...</p>
      </div>

      <!-- Schedule Grid -->
      <div class="schedule-grid" *ngIf="!loading">
        <div class="time-column">
          <div class="time-slot" *ngFor="let time of timeSlots">
            <span class="time-label">{{ time }}</span>
          </div>
        </div>

        <div class="events-column">
          <div class="time-slot-container" *ngFor="let time of timeSlots">
            <div class="time-slot-line"></div>
            
            <!-- Events for this time slot -->
            <div class="event-cards">
              <div 
                *ngFor="let item of getItemsForTimeSlot(time)"
                class="event-card"
                [ngClass]="{'event-from-service': item.type === 'event'}"
                [style.background-color]="item.type === 'planning' ? item.data.color : getEventColor(item.data)"
                [style.height.px]="calculateDuration(item.startTime, item.endTime) * 60"
              >
                <div class="event-header">
                  <span class="event-icon">
                    {{ item.type === 'planning' ? getEventTypeInfo(item.data.eventType).icon : getEventIcon(item.data) }}
                  </span>
                  <span class="event-time">{{ formatTime(item.startTime) }} - {{ formatTime(item.endTime) }}</span>
                </div>
                <h4 class="event-title">{{ item.data.title }}</h4>
                <p class="event-location" *ngIf="item.data.location">
                  üìç {{ item.data.location }}
                </p>
                <p class="event-description" *ngIf="item.type === 'planning' && item.data.description">
                  {{ item.data.description }}
                </p>
                <p class="event-description" *ngIf="item.type === 'event'">
                  Du {{ item.data.startDate | date:'dd/MM/yyyy' }} au {{ item.data.endDate | date:'dd/MM/yyyy' }}
                  <br>
                  Participations: {{ item.data.currentParticipations || 0 }}/{{ item.data.maxParticipations }}
                </p>
                <div class="event-actions" *ngIf="item.type === 'planning'">
                  <button class="action-btn edit-btn" (click)="editPlanning(item.data)" title="Modifier">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>
                  <button class="action-btn delete-btn" (click)="deletePlanning(item.data.planningId)" title="Supprimer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                  </button>
                </div>
                <div class="event-badge" *ngIf="item.type === 'event'">
                  <span>üìÖ √âv√©nement existant</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && getTotalEventsCount() === 0" class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <h3>Aucun √©v√©nement</h3>
        <p>Aucun √©v√©nement pr√©vu pour cette journ√©e</p>
      </div>
    </div>
  </div>
</div>
